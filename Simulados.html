<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Simulado DETRAN com Ranking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    header {
      background: #007BFF;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      border-bottom: 4px solid #0056b3;
    }
    nav {
      background: #0056b3;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    nav button {
      background: #007BFF;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px 4px 0 0;
      transition: background-color 0.3s ease;
    }
    nav button.active, nav button:hover {
      background: #003f7f;
    }
    main {
      flex-grow: 1;
      max-width: 900px;
      margin: 1rem auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      min-height: 60vh;
    }
    form section {
      margin-bottom: 1.5rem;
    }
    form h3 {
      margin-bottom: 0.5rem;
    }
    label {
      display: block;
      margin: 0.3rem 0;
      cursor: pointer;
    }
    input[type="radio"] {
      margin-right: 0.5rem;
    }
    button#startSimulado, button#submitSimulado {
      background-color: #007BFF;
      color: white;
      font-size: 1rem;
      padding: 0.75rem 1.2rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
      transition: background-color 0.3s ease;
    }
    button#startSimulado:hover, button#submitSimulado:hover {
      background-color: #0056b3;
    }
    .result {
      font-size: 1.2rem;
      margin-top: 1rem;
      text-align: center;
    }
    .aprovado {
      color: green;
      font-weight: bold;
    }
    .reprovado {
      color: red;
      font-weight: bold;
    }
    .gabarito {
      margin-top: 1.5rem;
      text-align: left;
    }
    .gabarito ul {
      padding-left: 1.5rem;
    }
    .ranking-list {
      margin-top: 1rem;
    }
    .ranking-list table {
      width: 100%;
      border-collapse: collapse;
    }
    .ranking-list th, .ranking-list td {
      border: 1px solid #ddd;
      padding: 0.5rem;
      text-align: center;
    }
    .ranking-list th {
      background-color: #007BFF;
      color: white;
    }
    .welcome {
      max-width: 500px;
      margin: 3rem auto;
      text-align: center;
      padding: 2rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .welcome input[type="text"] {
      width: 100%;
      padding: 0.6rem;
      font-size: 1rem;
      margin-top: 1rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <header>Simulado Teórico DETRAN - Com Ranking</header>
  <nav>
    <button id="btnHome" class="active">Simulado</button>
    <button id="btnRanking">Ranking</button>
  </nav>
  <main>
    <section id="welcomeSection" class="welcome">
      <h2>Bem-vindo ao Simulado DETRAN</h2>
      <p>Por favor, digite seu nome para começar:</p>
      <input type="text" id="usernameInput" placeholder="Seu nome" />
      <button id="startSimulado">Começar Simulado</button>
    </section>

    <section id="quizSection" style="display:none;">
      <form id="quizForm"></form>
      <button id="submitSimulado">Finalizar Simulado</button>
      <article id="resultado" class="result" style="display:none;"></article>
    </section>

    <section id="rankingSection" style="display:none;">
      <h2>Ranking de Usuários</h2>
      <div class="ranking-list">
        <table>
          <thead>
            <tr><th>Posição</th><th>Nome</th><th>Acertos</th><th>Porcentagem</th></tr>
          </thead>
          <tbody id="rankingBody">
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const perguntas = [
      ["O que fazer ao se aproximar de uma faixa de pedestres?", ["Aumentar a velocidade", "Buzinar", "Parar o veículo e dar preferência", "Continuar normalmente"], "C"],
      ["A placa 'PARE' indica:", ["Informação", "Advertência", "Regulamentação", "Obrigação de virar"], "C"],
      ["O uso do cinto de segurança é obrigatório para:", ["Apenas o motorista", "Passageiros da frente", "Todos os ocupantes", "Ninguém, é opcional"], "C"],
      ["Dirigir sob efeito de álcool gera:", ["Advertência", "Multa e suspensão da CNH", "Nada", "Apenas pontos na carteira"], "B"],
      ["Ao ver uma ambulância com sirene ligada, o condutor deve:", ["Continuar normalmente", "Disputar a via", "Dar passagem imediatamente", "Fechar a ambulância"], "C"],
      ["A manutenção preventiva do veículo serve para:", ["Tornar o veículo mais rápido", "Evitar falhas e acidentes", "Aumentar velocidade", "Enfeitar o carro"], "B"],
      ["Quando ocorre aquaplanagem, o condutor deve:", ["Freiar bruscamente", "Acelerar", "Desacelerar e manter o volante firme", "Virar o volante"], "C"],
      ["Qual a cor das placas de advertência?", ["Azul", "Vermelha", "Amarela", "Verde"], "C"],
      ["Quando usar o farol baixo durante o dia?", ["Em túneis e rodovias", "Somente à noite", "Ao estacionar", "Em manobras"], "A"],
      ["Parar sobre a faixa de pedestres é:", ["Permitido", "Recomendado", "Infração", "Obrigatório"], "C"],
      ["O triângulo de sinalização deve ser colocado a:", ["10m", "20m", "30m", "5m"], "C"],
      ["A função da embreagem é:", ["Aumentar potência", "Fazer o carro correr", "Trocar marchas", "Controlar direção"], "C"],
      ["A CNH é obrigatória:", ["Somente em rodovias", "Sempre ao dirigir", "Somente com passageiros", "Apenas em viagens"], "B"],
      ["Dirigir com braço para fora é:", ["Normal", "Leve", "Média", "Grave"], "D"],
      ["Sinalização de trânsito tem como objetivo:", ["Facilitar vida", "Indicar turismo", "Organizar e dar segurança", "Punir motoristas"], "C"],
      ["Uso de celular ao volante é:", ["Permitido", "Permitido com viva-voz", "Proibido (gravíssima)", "Permitido no sinal"], "C"],
      ["Pedestre tem prioridade:", ["Somente em passarelas", "Sempre", "Com criança", "Em faixas ou semáforo"], "D"],
      ["Extintor de incêndio deve ser usado:", ["Para sinalizar", "Em incêndio", "Para limpar motor", "Quando pneu furar"], "B"],
      ["Evitar fadiga ao dirigir por horas:", ["Tomar café", "Dormir ao volante", "Fazer pausas", "Ligar rádio alto"], "C"],
      ["Velocidade máxima em vias urbanas:", ["50 km/h", "60 km/h", "70 km/h", "80 km/h"], "B"],
      ["Frenagem de emergência deve ser:", ["Com embreagem", "Travando rodas", "Firme e com controle", "Soltar volante"], "C"],
      ["Uso da seta é obrigatório:", ["Ao estacionar", "Ao ultrapassar", "Sempre que mudar direção", "Só de dia"], "C"],
      ["Faixa contínua significa:", ["Pode ultrapassar", "Só moto pode passar", "Proibido ultrapassar", "Obrigatório parar"], "C"],
      ["Ao ver faixa de retenção:", ["Parar sobre a faixa", "Parar antes da faixa", "Avançar até o semáforo", "Ignorar"], "B"],
      ["Placa azul indica:", ["Advertência", "Regulamentação", "Indicação", "Obrigação"], "C"],
      ["Placa de velocidade é:", ["Advertência", "Educativa", "Regulamentação", "Indicação"], "C"],
      ["Ao mudar de faixa em túnel:", ["Ligar alerta", "Ligar farol alto", "Usar seta", "Nada"], "C"],
      ["Lombadas são indicadas por placa de:", ["Indicação", "Advertência", "Regulamentação", "Educativa"], "B"],
      ["Se recusar ao bafômetro resulta em:", ["Advertência", "Nada", "Multa e suspensão", "Pontos"], "C"],
      ["Sulcos do pneu devem ter no mínimo:", ["0,5mm", "1,6mm", "2,5mm", "3mm"], "B"]
    ];

    const btnHome = document.getElementById('btnHome');
    const btnRanking = document.getElementById('btnRanking');
    const welcomeSection = document.getElementById('welcomeSection');
    const quizSection = document.getElementById('quizSection');
    const rankingSection = document.getElementById('rankingSection');
    const quizForm = document.getElementById('quizForm');
    const resultado = document.getElementById('resultado');
    const usernameInput = document.getElementById('usernameInput');
    const startSimuladoBtn = document.getElementById('startSimulado');
    const submitSimuladoBtn = document.getElementById('submitSimulado');
    const rankingBody = document.getElementById('rankingBody');

    let currentUser = null;

    function switchTab(tab) {
      btnHome.classList.remove('active');
      btnRanking.classList.remove('active');
      welcomeSection.style.display = 'none';
      quizSection.style.display = 'none';
      rankingSection.style.display = 'none';
      resultado.style.display = 'none';

      if(tab === 'home') {
        btnHome.classList.add('active');
        if (!currentUser) {
          welcomeSection.style.display = 'block';
        } else {
          quizSection.style.display = 'block';
        }
      } else if(tab === 'ranking') {
        btnRanking.classList.add('active');
        rankingSection.style.display = 'block';
        carregarRanking();
      }
    }

    btnHome.addEventListener('click', () => switchTab('home'));
    btnRanking.addEventListener('click', () => switchTab('ranking'));

    startSimuladoBtn.addEventListener('click', () => {
      const nome = usernameInput.value.trim();
      if(nome.length < 2) {
        alert('Por favor, insira seu nome para continuar.');
        return;
      }
      currentUser = nome;
      welcomeSection.style.display = 'none';
      quizSection.style.display = 'block';
      gerarQuestões();
    });

    function gerarQuestões() {
      quizForm.innerHTML = '';
      resultado.style.display = 'none';

      perguntas.forEach((pergunta, i) => {
        const section = document.createElement('section');
        section.innerHTML = `<h3>${i + 1}. ${pergunta[0]}</h3>` +
          pergunta[1].map((alt, j) =>
            `<label><input type="radio" name="q${i+1}" value="${String.fromCharCode(65+j)}"> ${alt}</label>`
          ).join('');
        quizForm.appendChild(section);
      });
    }

    submitSimuladoBtn.addEventListener('click', () => {
      let acertos = 0;
      let erros = [];
      perguntas.forEach((pergunta, i) => {
        const resposta = document.querySelector(`input[name="q${i+1}"]:checked`);
        const correta = pergunta[2];
        if (resposta && resposta.value === correta) {
          acertos++;
        } else {
          erros.push({ numero: i+1, correta });
        }
      });

      const total = perguntas.length;
      const porcentagem = (acertos / total) * 100;
      const aprovado = porcentagem >= 70;

      let html = `
        <p>Você acertou <strong>${acertos}</strong> de <strong>${total}</strong> questões.</p>
        <p>Porcentagem de acertos: <strong>${porcentagem.toFixed(2)}%</strong></p>
        <p class="${aprovado ? 'aprovado' : 'reprovado'}">${aprovado ? '✅ Aprovado!' : '❌ Reprovado!'}</p>
      `;

      if (erros.length > 0) {
        html += `<div class="gabarito"><h4>❌ Questões incorretas:</h4><ul>`;
        erros.forEach(e => {
          html += `<li>Questão ${e.numero} - Resposta correta: <strong>${e.correta}</strong></li>`;
        });
        html += `</ul></div>`;
      }

      resultado.innerHTML = html;
      resultado.style.display = 'block';
      window.scrollTo({ top: resultado.offsetTop, behavior: "smooth" });

      salvarResultado(currentUser, acertos, porcentagem);
    });

    function salvarResultado(nome, acertos, porcentagem) {
      const dadosRaw = localStorage.getItem('simuladoRanking');
      let dados = dadosRaw ? JSON.parse(dadosRaw) : [];
      // Ver
